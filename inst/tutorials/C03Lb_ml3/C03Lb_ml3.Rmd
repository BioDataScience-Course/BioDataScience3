---
title: "Machine learning (3)"
author: "Guyliann Engels & Philippe Grosjean"
description: "**SDD III Module 3** Machines à vecteurs supports et réseaux de neurones."
tutorial:
  id: "C03Lb_ml3"
version: 2.0.0/4
output:
  learnr::tutorial:
  progressive: true
allow_skip: true
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
BioDataScience3::learnr_setup()
SciViews::R()
library(mlearning)

# datasets
dermatology <- read("dermatology", package= "BioDataScience3")
derma <- sselect(dermatology, c(1:11, 34:35))
derma <- na_omit(derma, cols = "age")

# quizz
set.seed(960412)
## Classifieur
# Machine à vecteurs supports
derma_svmr <- mlSvm(data = derma, class~.)
# Machine à vecteurs supports avec un noyau linéaire
derma_svml <- mlSvm(data = derma, class~., kernel = "linear")
# Réseaux de neurones artificiels
derma_nnet <- mlNnet(data = derma, class~.)
## Métriques
# Machine à vecteurs supports
cvpredict(derma_svmr, cv.k = 5) |> confusion(derma$class) |> summary() ->
  svmr_tab
# Machine à vecteurs supports avec un noyau linéaire
cvpredict(derma_svml, cv.k = 5) |> confusion(derma$class) |> summary() ->
  svml_tab
# Réseaux de neurones artificiels
cvpredict(derma_nnet, cv.k = 5) |> confusion(derma$class) |> summary() ->
  nnet_tab
```

```{r, echo=FALSE}
BioDataScience3::learnr_banner()
```

```{r, context="server"}
BioDataScience3::learnr_server(input, output, session)
```

------------------------------------------------------------------------

## Objectifs

Ce tutoriel a pour objectif de vous faire découvrir 2 nouvelles méthodes qui vont s'ajouter à l'analyse discriminante linéaire, les K plus proches voisins, le partitionnement récursif et la forêt aléatoire. Les méthodes sont la machine à vecteurs supports et le réseaux de neurones artificiels.

Ces deux nouvelles méthodes sont disponible dans le package {mlearning}

| **Méthode**                     | **Fonction**                 |
|---------------------------------|------------------------------|
| Analyse discriminante linéaire  | mlLda(data, formula,...)     |
| K plus proches voisins          | mlKnn(data, formula,...)     |
| Partitionnement récursif        | mlRpart(data, formula,...)   |
| Foret aléatoire                 | mlRforest(data, formula,...) |
| Machine à vecteurs supports     | mlSvm(data, formula,...)     |
| Réseaux de neurones artificiels | mlNnet(data, formula,...)    |

## Discrimination de maladie de la peau.

Discriminer des maladies de la peau n'est pas une tache aisée pour les dermatologue. Plusieurs maladies peuvent avoir des symptômes similaires. Aidez ces médecins à mettre en place un classifieur pouvant les aider à distinguer une maladie sur base de 12 variables cliniques.

Vous avez à votre disposition le tableau `derma`.

```{r, echo = TRUE}
dermatology <- read("dermatology", package= "BioDataScience3")
```

Ce tableau comprend 12 variables obtenues par des observations directes du médécin et 22 requièrent un prélèvement pour être étudier à l'aide de méthode histoplogiques.

```{r}
skimr::skim(dermatology)
```

Ce jeu de données comprends 8 valeurs manquantes pour la variable age. La variable `class` reprend les 6 niveaux que vous allez devoir prédire avec vos classifieurs. La différentes maladies ne sont pas distribuées de manière homogène dans le tableau de données.

La variable `family_history` peut prendre soit la valeur de 0 (aucune maladie de la peau dans la famille), soit la valeur de 1 (maladie présente dans la famille.) Les autres attributs peuvent prendre 4 valeurs allant de 0 (absence), 1, 2 et 3 (très important).

Tentez de mettre en place un classifieur n'utilisant que les observations cliniques. Sélectionnez les variables 1 à 11 et 34 à 35. Utilisez la fonction `sselect()`. Filtrez ensuite les individus contenant des valeurs manquantes avec la fonction na_omit().

```{r derma_h2, exercise= TRUE}
# Selection des varaibles d'intérêts
derma <- sselect(___, c(___:___, ___:___))
# Elimination des NA
___ <- na_omit(___, cols = ___)
```

```{r derma_h2-hint-1}
# Selection des varaibles d'intérêts
derma <- sselect(dermatology, c(___:___, ___:___))
# Elimination des NA
derma <- na_omit(derma, cols = ___)
```

```{r derma_h2-solution}
# Selection des varaibles d'intérêts
derma <- sselect(dermatology, c(1:11, 34:35))
# Elimination des NA
derma <- na_omit(derma, cols = "age")
```

```{r derma_h2-check}
grade_code("Bien joué ! Le remaniement des données n'a plus de secret pour vous.")
```

C'est à vous d'explorer ce tableau. Vous avez la possibilité de réaliser tous les analyses et graphiques que vous désirez.

```{r explo_noscor, exercise=TRUE}

```

## Création des classifieurs

Créez à présent trois classifieurs utilisant la machine à vecteurs supports avec un noyau radial, la machine à vecteurs supports avec un noyeau linéaire et le réseaux de neurones artificiels. Utilisez le tableau `derma` et prédisez la variable `class`.

```{r, classif_h2, exercise = TRUE}
set.seed(960412)
# Machine à vecteurs supports
derma_svmr <- mlSvm(data = ___, ___~___)
# Machine à vecteurs supports avec un noyau linéaire
derma_svml <- mlSvm(data = ___, ___~___, ___ = "linear")
# Réseaux de neurones artificiels
derma_nnet <- mlNnet(data = ___, ___~___)
```

```{r, classif_h2-hint-1}
set.seed(960412)
# Machine à vecteurs supports
derma_svmr <- mlSvm(data = derma, ___~___)
# Machine à vecteurs supports avec un noyau linéaire
derma_svml <- mlSvm(data = ___, ___~___, kernel = "linear")
# Réseaux de neurones artificiels
derma_nnet <- mlNnet(data = ___, ___~___)
```

```{r, classif_h2-solution}
set.seed(960412)
# Machine à vecteurs supports
derma_svmr <- mlSvm(data = derma, class~.)
# Machine à vecteurs supports avec un noyau linéaire
derma_svml <- mlSvm(data = derma, class~., kernel = "linear")
# Réseaux de neurones artificiels
derma_nnet <- mlNnet(data = derma, class~.)
```

Evaluer les performances de vos trois classifieurs par validation croisée 5 fois.

```{r predict_h2, exercise = TRUE}
set.seed(960412)
# Machine à vecteurs supports
cvpredict(___, ___ = ___) |> confusion(___$___) |> summary()
# Machine à vecteurs supports avec un noyau linéaire
cvpredict(___, ___ = ___) |> confusion(___$___) |> summary()
# Réseaux de neurones artificiels
cvpredict(___, __ = ___) |> confusion(___$___) |> summary()
```

```{r predict_h2-hint-1}
set.seed(960412)
# Machine à vecteurs supports
cvpredict(derma_svmr, cv.k = 5) |> confusion(___$___) |> summary()
# Machine à vecteurs supports avec un noyau linéaire
cvpredict(___, ___) |> confusion(___$___) |> summary()
# Réseaux de neurones artificiels
cvpredict(___, ___) |> confusion(___$___) |> summary()
```

```{r predict_h2-solution}
set.seed(960412)
# Machine à vecteurs supports
cvpredict(derma_svmr, cv.k = 5) |> confusion(derma$class) |> summary()
# Machine à vecteurs supports avec un noyau linéaire
cvpredict(derma_svml, cv.k = 5) |> confusion(derma$class) |> summary()
# Réseaux de neurones artificiels
cvpredict(derma_nnet, cv.k = 5) |> confusion(derma$class) |> summary()
```

```{r predict_h2-check}
grade_code("Bien joué ! Il ne vous reste plus qu'à répondre aux questions ci-dessous")
```

```{r qu_pred}
#nnet_tab
#svml_tab
#svmr_tab

question("Quel classifieur permet d'avoir la meilleure précision pour la classe des `seboreic dermatitis`?",
    answer("Machine à vecteurs supports avec un noyau linéaire", correct = TRUE),
    answer("Machine à vecteurs supports à noyau radial"),
    answer("Réseaux de neurones artificiels"),
    allow_retry = TRUE, 
    submit_button = "Soumettre une réponse",
    try_again_button = "Resoumettre une réponse",
    incorrect = "Mauvaise réponse. Recommencez et analysez les métriques des trois classifieurs.",
    correct = "Bravo, c'est correct !")

```

## Conclusion

Bien joué ! Vous venez de découvrir 2 nouveaux algorithmes de classifications supervisées. Votre boite à outils s'étoffe encore.

```{r comm_noscore, echo=FALSE}
question_text(
  "Laissez-nous vos impressions sur cet outil pédagogique",
  answer("", TRUE, message = "Pas de commentaires... C'est bien aussi."),
  incorrect = "Vos commentaires sont enregistrés.",
  placeholder = "Entrez vos commentaires ici...",
  allow_retry = TRUE
)
```
